<link rel="import" href="../polymer/polymer.html">

<!--
`full-width-text`
Makes the inner text fit the width of the element

@demo demo/index.html 
-->

<dom-module id="full-width-text">
  <template>
    <style>
      :host {
        display: block;
      }

      #container {
        width: 200px;
        border: red 1px solid;
      }
    </style>

    <content></content>

  </template>

  <script>
    Polymer({

      is: 'full-width-text',
      
      properties: {

        /**
          * Enabe log
          */
        log: Boolean
      },

      attached: function () {
          this.scale();
      },

      scale: function() {
        var min = 1;
        var max = 150;
        var el = this;
        var width = el.clientWidth - 0.5;
        var text = el.innerText;

        var current = (min + max) / 2;
        el.style.fontSize = current + "px";

        this._startLog(text, width);

        for (var i = 0 ; i < 15; i++) {
          var font = getStyle(el, "font");
          var twidth = getTextWidth(text, font);

          this._log(twidth, current, font);

          if (twidth < width) {
            min = current;
          } else {
            max = current;
          }

          current = (min + max) / 2;
          el.style.fontSize = current + "px";
        }

        this._endLog();
      },

      _startLog: function(text, width) {
        if (!this.log) return;
        this._logData = [];
        console.groupCollapsed("full-width-text: " + text);
        console.log("Target width: " + width);
      },

      _log: function(twidth, current, font) {
        if (!this.log) return;
        this._logData.push({
          'font size': current,
          'current width': twidth,
          'font': font,
        })
      },

      _endLog: function() {
        if (!this.log) return;
        console.table(this._logData);
        console.groupEnd();
      },
    });

    function getTextWidth(text, font) {
      var canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
      var context = canvas.getContext("2d");
      context.font = font;
      var metrics = context.measureText(text);
      return metrics.width;
    }

    function getStyle(el, prop) {
      if (window.getComputedStyle) {
        return getComputedStyle(el).getPropertyValue(prop);
      }   
      try {
        return el.currentStyle[prop];
      } catch (e) {
        return "";
      }
    }
  </script>
</dom-module>
